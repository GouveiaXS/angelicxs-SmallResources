-- -- -- Scenario List = https://pastebin.com/6mrYTdQv
-- -- -- Model List = https://docs.fivem.net/docs/game-references/ped-models/ 

NPCConfig = {
    {   
        Model = 's_m_m_gentransport',
        Coords = vector4(-941.22, -2035.39, 9.05, 137.73),
        Scenario = 'WORLD_HUMAN_LEANING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_m_m_gentransport',
        Coords = vector4(-349.36, -126.33, 39.06, 157.82),
        Scenario = 'WORLD_HUMAN_LEANING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'a_m_m_hillbilly_01',
        Coords = vector4(-310.38, 6185.56, 31.56, 41.91),
        Scenario = 'WORLD_HUMAN_SMOKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'a_m_m_hillbilly_01',
        Coords = vector4(1128.77, -776.95, 57.61, 358.58),
        Scenario = 'WORLD_HUMAN_SMOKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'cs_clay',
        Coords = vector4(1718.52, 4790.42, 41.99, 359.08),
        Scenario = 'WORLD_HUMAN_LEANING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'cs_clay',
        Coords = vector4(1109.16, -2193.15, 30.72, 84.71),
        Scenario = 'WORLD_HUMAN_LEANING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
        Event3eye = 'angelicxs-randomshop:openMenu',
        Label3eye = "Over Here",
    },
    {   
        Model = 'a_m_m_business_01',
        Coords = vector4(-552.49, -202.83, 38.24, 337.8),
        Scenario = 'WORLD_HUMAN_CLIPBOARD',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
        Event3eye = 'angelicxs-playertransfer:checker',
        Label3eye = "Money Transfers",
    },
    {   
        Model = 'csb_bogdan',
        Coords = vector4(-1812.9, 3092.37, 32.84, 326.6),
        Scenario = 'WORLD_HUMAN_CLIPBOARD',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'a_m_y_skater_02',
        Coords = vector4(-206.54, -1341.68, 34.89, 89.52),
        Scenario = 'WORLD_HUMAN_LEANING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'a_m_y_musclbeac_01',
        Coords = vector4(-1206.91, -1571.2, 4.59, 119.96),
        Scenario = 'WORLD_HUMAN_MUSCLE_FREE_WEIGHTS',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'a_f_y_tennis_01',
        Coords = vector4(-1255.54, -354.55, 36.96, 295.23),
        Scenario = 'EAR_TO_TEXT',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_scrubs_01',
        Coords = vector4(356.64, -1408.35, 32.99, 55.47),
        Scenario = 'EAR_TO_TEXT',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },

---tropical peds

    {   
        Model = 'csb_agatha',
        Coords = vector4(299.65, -911.86, 52.8, 52.03),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_agatha',
        Coords = vector4(287.66, -927.93, 52.8, 299.52),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_tonyprince',
        Coords = vector4(288.83, -927.9, 52.8, 26.59),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_tonyprince',
        Coords = vector4(305.27, -937.22, 52.8, 63.82),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_reporter',
        Coords = vector4(305.26, -937.22, 52.8, 63.42),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_reporter',
        Coords = vector4(302.01, -937.31, 52.8, 290.44),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_mrs_r',
        Coords = vector4(302.29, -936.31, 52.8, 252.11),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_mrs_r',
        Coords = vector4(309.22, -935.7, 52.8, 44.6),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_anita',
        Coords = vector4(305.18, -936.32, 52.8, 109.96),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_anita',
        Coords = vector4(296.91, -938.01, 52.8, 352.59),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'csb_abigail',
        Coords = vector4(295.6, -937.42, 52.8, 306.36),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_baywatch_01',
        Coords = vector4(304.71, -929.95, 52.95, 270.3),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_hooker_01',
        Coords = vector4(305.64, -930.0, 52.93, 77.27),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_hooker_03',
        Coords = vector4(305.1, -930.67, 52.94, 355.04),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_hooker_03',
        Coords = vector4(293.72, -914.62, 52.8, 354.33),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'mp_m_weapexp_01',
        Coords = vector4(292.1, -930.77, 52.8, 352.1),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'mp_m_weapexp_01',
        Coords = vector4(292.54, -929.65, 52.8, 160.88),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'mp_m_famdd_01',
        Coords = vector4(293.25, -930.62, 52.8, 66.88),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'g_m_y_mexgoon_01',
        Coords = vector4(291.84, -930.09, 52.8, 258.88),
        Scenario = 'WORLD_HUMAN_DRINKING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },

----- partying

    {   
        Model = 'g_m_y_mexgoon_01',
        Coords = vector4(300.59, -917.75, 52.8, 329.77),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'g_m_y_mexgoon_02',
        Coords = vector4(301.56, -916.96, 52.8, 94.39),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_hooker_03',
        Coords = vector4(299.88, -916.34, 52.8, 151.49),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_bartender_01',
        Coords = vector4(301.26, -914.77, 52.8, 242.37),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_bartender_01',
        Coords = vector4(302.26, -914.47, 52.8, 205.85),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_bartender_01',
        Coords = vector4(304.42, -914.45, 52.8, 251.08),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_bartender_01',
        Coords = vector4(305.67, -913.94, 52.8, 151.7),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_hooker_03',
        Coords = vector4(305.47, -914.79, 52.8, 32.95),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_f_y_bartender_01',
        Coords = vector4(304.14, -916.32, 52.8, 222.24),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_m_m_fiboffice_01',
        Coords = vector4(303.23, -917.32, 52.8, 248.81),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 's_m_m_movprem_01',
        Coords = vector4(303.01, -918.69, 52.8, 277.04),
        Scenario = 'WORLD_HUMAN_PARTYING',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
    },
    {   
        Model = 'cs_clay',
        Coords = vector4(242.44, -896.1, 29.14, 207.5),
        Scenario = 'WORLD_HUMAN_CLIPBOARD',
        IgnoreEvents = true,
        Invincible = true,
        Frozen = true,
        Event3eye = 'angelicxs-buybackProgram',
        Label3eye = "Government Vehicle Buyback",
    },
}



------------------------------------------ SCRIPT ----------------------------------------
local Entity = {}
CreateThread(function()
    for i = 1, #NPCConfig do
        CreateThread(function()
            local ped = NPCConfig[i]
            local PedSpawned = false
            Entity[i] = nil
            while true do
                local Player = PlayerPedId()
                local Pos = GetEntityCoords(Player)
                local Dist = #(Pos - vector3(ped.Coords.x,ped.Coords.y,ped.Coords.z))
                if Dist <= 50 and not PedSpawned then
                    TriggerEvent('angelicxs-pedSpawner:PedSpawner',ped,i)
                    PedSpawned = true
                elseif DoesEntityExist(Entity[i]) and PedSpawned then
                    local Dist2 = #(Pos - GetEntityCoords(Entity[i]))
                    if Dist2 > 50 then
                        SetEntityAsNoLongerNeeded(Entity[i])
                        PedSpawned = false
                    end
                end
                Wait(2000)
            end
        end)
    end
end)

RegisterNetEvent('angelicxs-pedSpawner:PedSpawner',function(ped,set)
    local hash = HashGrabber(ped.Model)
    Entity[set] = CreatePed(3, hash, ped.Coords.x, ped.Coords.y, (ped.Coords.z-1) , ped.Coords.w, false, false)
    SetEntityHeading(Entity[set], ped.Coords.w)
    FreezeEntityPosition(Entity[set], ped.Frozen)
    SetEntityInvincible(Entity[set], ped.Invincible)
    SetBlockingOfNonTemporaryEvents(Entity[set], ped.IgnoreEvents)
    TaskStartScenarioInPlace(Entity[set],ped.Scenario, 0, false)
    SetModelAsNoLongerNeeded(ped.Model)
    if ped.Event3eye then
        local ox_options = {
            {
            name = tostring(ped.Event3eye..set),
            event = ped.Event3eye,
            label = ped.Label3eye
            },
        }
        exports.ox_target:addLocalEntity(Entity[set], ox_options)
    end
end)

function HashGrabber(model)
    local hash = GetHashKey(model)
    if not HasModelLoaded(hash) then
        RequestModel(hash)
        Wait(10)
    end
    while not HasModelLoaded(hash) do
      Wait(10)
    end
    return hash
end

AddEventHandler('onResourceStop', function(resource)
    if GetCurrentResourceName() == resource then
        for i=1, #Entity do
            if DoesEntityExist(Entity[i]) then
                DeleteEntity(Entity[i])
            end
        end
    end
end)

local drivebyspeed = 80 -- set max speed you can shoot from car

CreateThread(function()
    local view = false
    while true do
        local sleep = 1500
        local ped = PlayerPedId()
        local vehicle = IsPedInAnyVehicle(ped, true)
        if vehicle then 
            sleep = 0
            if GetEntitySpeed(GetVehiclePedIsIn(ped, false)) * 2.236936 <= drivebyspeed then --- if KM/H use 3.6 for MPH use 2.236936
                SetPlayerCanDoDriveBy(ped, true)
            else
                SetPlayerCanDoDriveBy(ped, false)
            end
            if IsPedDoingDriveby(ped) then 
                if not view then
                    view = GetFollowVehicleCamViewMode()
                end
                SetFollowVehicleCamViewMode(4)
            else
                if view then
                    SetFollowVehicleCamViewMode(view)
                    view = false
                end
            end
        end
        Wait(sleep)
    end
end)